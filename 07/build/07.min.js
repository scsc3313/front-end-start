/*! 07 2015-05-07 */
function addTodo(a){console.log("todoStringField keyup!");var b=$(a.currentTarget),c=b.val();if(13!==a.keyCode||""===c)return console.log("event stop"),!1;b.val("");var d=(new Date).getTime(),e=$.extend({},Todo.model,{id:d,title:c});console.log("newâ€‹ todo.model:",e),collection.add(e)}var todos=[],collection={add:function(a){todos.push(a),$(document.body).trigger("addCollection")},remove:function(a){for(var b=0;b<todos.length;b++)if(todos[b].id===a){console.log("find",b),todos.splice(b,1);break}$(document.body).trigger("removeCollection")},checked:function(a){for(var b=0;b<todos.length;b++)if("unchecked"===todos[b].checked){console.log("find",b),todos.splice(b,1);break}$(document.body).trigger("checkedCollection")}},Todo={model:{id:"",title:"",time:"",checkbox:"unchecked"}},$listDom=$("#todoList"),todoTemplateHtml=$("#todoTemplate").html(),view={render:function(){$listDom.html(tmpl(todoTemplateHtml,{todos:todos}))}};$(document.body).on("addCollection",view.render),$(document.body).on("removeCollection",view.render);var storage={load:function(){return console.log("storage.load()"),JSON.parse(localStorage.getItem("todos")||"[]")},save:function(){console.log("storage.save()"),localStorage.setItem("todos",JSON.stringify(todos))}};$(document.body).on("addCollection",storage.save),$(document.body).on("removeCollection",storage.save),function(){var a={};this.tmpl=function b(c,d){var e=/\W/.test(c)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+c.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):a[c]=a[c]||b(document.getElementById(c).innerHTML);return d?e(d):e}}(),function(a,b){var c=a("#todoString"),d=a("#todoList");c.on("keyup",addTodo),d.on("click",".delete",function(b){var c=a(b.target),d=c.parent().data("id");collection.remove(d)}),d.on("click",".toggle-checked",function(b){var c=a(b.target),d=c.parent().data("id");collection.remove(d)}),todos=storage.load(),view.render()}(jQuery,window);